(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();class c{static TOPPINGS=["yasai","ninniku","abura"];static AMOUNTS=["nashi","sukuname","futsu","mashi","mashimashi"];static PRESS_COUNT={nashi:0,sukuname:1};static generate(){if(Math.random()<.1)return Math.random()<.5?this.createZenMashi():this.createZenMashiMashi();const e={yasai:1,ninniku:0,abura:0,parts:[]},t=Math.random();t<.2?(e.yasai=0,e.parts.push("ヤサイなし")):t<.4?(e.yasai=2,e.parts.push("ヤサイマシ")):t<.5?(e.yasai=3,e.parts.push("ヤサイマシマシ")):t<.7&&(e.yasai=1,e.parts.push("ヤサイ"));const r=Math.random();r<.3||(r<.6?(e.ninniku=1,e.parts.push("ニンニク")):r<.8?(e.ninniku=2,e.parts.push("ニンニクマシ")):(e.ninniku=3,e.parts.push("ニンニクマシマシ")));const n=Math.random();n<.3||(n<.6?(e.abura=1,e.parts.push("アブラ")):n<.8?(e.abura=2,e.parts.push("アブラマシ")):(e.abura=3,e.parts.push("アブラマシマシ")));for(let i=e.parts.length-1;i>0;i--){const o=Math.floor(Math.random()*(i+1));[e.parts[i],e.parts[o]]=[e.parts[o],e.parts[i]]}return e.parts.length===0?e.text="そのまま":e.text=e.parts.join(""),e}static createZenMashi(){return{yasai:2,ninniku:2,abura:2,text:"全マシ"}}static createZenMashiMashi(){return{yasai:3,ninniku:3,abura:3,text:"全マシマシ"}}}class u{constructor(){this.score=0,this.timeLeft=60,this.timerInterval=null,this.isPlaying=!1,this.currentOrder=null,this.currentInput={yasai:0,ninniku:0,abura:0},this.screens={start:document.getElementById("start-screen"),game:document.getElementById("game-screen"),result:document.getElementById("result-screen"),howto:document.getElementById("howto-screen")},this.ui={timer:document.getElementById("timer"),score:document.getElementById("score"),finalScore:document.getElementById("final-score"),callBubble:document.getElementById("call-bubble"),badges:{yasai:document.getElementById("badge-yasai"),ninniku:document.getElementById("badge-ninniku"),abura:document.getElementById("badge-abura")}}}init(){this.attachEventListeners()}attachEventListeners(){document.getElementById("start-btn").addEventListener("click",()=>this.startGame()),document.getElementById("retry-btn").addEventListener("click",()=>this.startGame()),document.getElementById("share-btn").addEventListener("click",()=>this.shareResult()),document.getElementById("howto-btn").addEventListener("click",()=>this.showScreen("howto")),document.getElementById("back-from-howto-btn").addEventListener("click",()=>this.showScreen("start")),document.querySelectorAll(".topping-btn").forEach(s=>{s.addEventListener("click",e=>{const t=e.currentTarget.dataset.type;this.addTopping(t)})}),document.getElementById("reset-btn").addEventListener("click",()=>this.resetInput()),document.getElementById("serve-btn").addEventListener("click",()=>this.serveOrder())}showScreen(s){Object.values(this.screens).forEach(e=>{e.classList.add("hidden"),e.classList.remove("active")}),this.screens[s].classList.remove("hidden"),this.screens[s].classList.add("active")}startGame(){this.score=0,this.timeLeft=60,this.isPlaying=!0,this.updateUI(),this.showScreen("game"),this.nextOrder(),this.startTimer()}startTimer(){this.timerInterval&&clearInterval(this.timerInterval),this.timerInterval=setInterval(()=>{this.timeLeft--,this.timeLeft<=0&&this.endGame(),this.updateUI()},1e3)}endGame(){clearInterval(this.timerInterval),this.isPlaying=!1,this.ui.finalScore.textContent=`${this.score}杯`,this.showScreen("result")}nextOrder(){this.currentOrder=c.generate(),this.resetInput(),this.ui.callBubble.textContent=this.currentOrder.text}resetInput(){this.currentInput={yasai:0,ninniku:0,abura:0},this.updateBadges()}addTopping(s){this.isPlaying&&(this.currentInput[s]++,this.currentInput[s]>3&&(this.currentInput[s]=3),this.updateBadges())}updateBadges(){["yasai","ninniku","abura"].forEach(s=>{this.ui.badges[s].querySelectorAll(".dot").forEach((t,r)=>{t.classList.toggle("filled",r<this.currentInput[s])})})}serveOrder(){this.isPlaying&&(this.validateOrder()?(this.score+=1,this.triggerFeedback(!0)):this.triggerFeedback(!1),this.nextOrder(),this.updateUI())}triggerFeedback(s){const e=s?"var(--color-accent)":"var(--color-secondary)";this.ui.score.style.color=e,this.ui.score.style.transform="scale(1.5)",setTimeout(()=>{this.ui.score.style.color="white",this.ui.score.style.transform="scale(1)"},300);const t=document.createElement("div");t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.width="100%",t.style.height="100%",t.style.backgroundColor=s?"rgba(46, 213, 115, 0.2)":"rgba(255, 71, 87, 0.2)",t.style.pointerEvents="none",t.style.zIndex="5",document.getElementById("game-screen").appendChild(t),setTimeout(()=>t.remove(),200)}validateOrder(){return this.currentInput.yasai===this.currentOrder.yasai&&this.currentInput.ninniku===this.currentOrder.ninniku&&this.currentInput.abura===this.currentOrder.abura}updateUI(){this.ui.timer.textContent=this.timeLeft,this.ui.score.textContent=this.score}shareResult(){const s=`マシマシRUSH!!でラーメンを${this.score}杯提供しました！ #マシマシRUSH`,e="https://twitter.com/intent/tweet?text="+encodeURIComponent(s);window.open(e,"_blank")}}document.addEventListener("DOMContentLoaded",()=>{new u().init()});
